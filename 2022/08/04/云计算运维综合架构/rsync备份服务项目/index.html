<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>rsync备份服务项目 | 今日放弃堕落</title><meta name="author" content="JANKINLUI"><meta name="copyright" content="JANKINLUI"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="学习rsync，并实现部署rsync备份服务项目，以及常见问题">
<meta property="og:type" content="article">
<meta property="og:title" content="rsync备份服务项目">
<meta property="og:url" content="http://blog.cndis.cn/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/index.html">
<meta property="og:site_name" content="今日放弃堕落">
<meta property="og:description" content="学习rsync，并实现部署rsync备份服务项目，以及常见问题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2022-08-04T12:10:45.000Z">
<meta property="article:modified_time" content="2022-10-20T04:04:55.397Z">
<meta property="article:author" content="JANKINLUI">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="云计算运维综合架构">
<meta property="article:tag" content="rsync">
<meta property="article:tag" content="备份服务项目">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://blog.cndis.cn/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/pluginsSrc/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.min.js',
      css: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'rsync备份服务项目',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-20 12:04:55'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="今日放弃堕落" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">85</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%85%B3%E4%BA%8E"><i class="fa-fw /about/"></i><span> 0</span></a></li><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 1</span></a></li><li><a class="site-page child" href="/butterfly%E4%B8%BB%E9%A2%98"><i class="fa-fw https://github.com/jerryc127/hexo-theme-butterfly/"></i><span> 2</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">今日放弃堕落</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%85%B3%E4%BA%8E"><i class="fa-fw /about/"></i><span> 0</span></a></li><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 1</span></a></li><li><a class="site-page child" href="/butterfly%E4%B8%BB%E9%A2%98"><i class="fa-fw https://github.com/jerryc127/hexo-theme-butterfly/"></i><span> 2</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">rsync备份服务项目</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-08-04T12:10:45.000Z" title="发表于 2022-08-04 20:10:45">2022-08-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-10-20T04:04:55.397Z" title="更新于 2022-10-20 12:04:55">2022-10-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/">云计算运维综合架构</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="rsync备份服务项目"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="第1章-rsync-软件介绍"><a href="#第1章-rsync-软件介绍" class="headerlink" title="第1章 rsync 软件介绍"></a><strong>第</strong>1章 <strong>rsync</strong> <strong>软件介绍</strong></h1><h2 id="1-1-什么是rsync"><a href="#1-1-什么是rsync" class="headerlink" title="1.1 什么是rsync"></a><strong>1.1</strong> 什么是rsync</h2><p>rsync 是一款开源的、快速的、多功能的、可实现全量及增量的本地或远程数据同步备份的优秀工具。</p>
<p><a target="_blank" rel="noopener" href="http://www.samba.org/ftp/rsync/rsync.html">英文手册阅读</a></p>
<h3 id="1-1-1-全量及增量"><a href="#1-1-1-全量及增量" class="headerlink" title="1.1.1 全量及增量"></a><strong>1.1.1</strong> 全量及增量</h3><p>全量：将全部数据，进行传输覆盖</p>
<p>增量：只传输差异部分的数据</p>
<h2 id="1-2-实现增量复制的原理"><a href="#1-2-实现增量复制的原理" class="headerlink" title="1.2 实现增量复制的原理"></a><strong>1.2</strong> 实现增量复制的原理</h2><p>Rsync通过其独特的“quick check”算法，实现增量传输数据</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]#man rsync</span><br><span class="line">Rsync  finds  files  that  need  to  be transferred using a “quick check” algorithm (by default)  that  looks  for  files  that  have changed  in  size  or  in  last-modified time.  Any changes in the other preserved attributes (as requested by options) are  made  on the  destination file directly when the quick check indicates that the file’s data does not need to be updated.</span><br></pre></td></tr></table></figure>

<p>在同步备份数据时，默认情况下，Rsync通过其独特的“quick check”算法，它仅同步大小或者最后修改时间发生变化的文件或目录，当然也可根据权限，属主等属性的变化同步，但需要指定相应的参数，甚至可以实现只同步一个文件里有变化的内容部分，所以，可以实现快速的同步备份数据。</p>
<blockquote>
<p>ps</p>
<p><em>centos 5 rsync 2.x</em> <em>先比对再同步，速度较慢</em></p>
<p> <em>centos 6 rsync 3.x</em> <em>一边比对，一边对差异部分进行同步</em></p>
</blockquote>
<h3 id="1-2-1-软件版本"><a href="#1-2-1-软件版本" class="headerlink" title="1.2.1 软件版本"></a><strong>1.2.1</strong> 软件版本</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# rsync --version</span><br><span class="line">rsync  version 3.0.6  protocol version 30</span><br><span class="line">Copyright (C) 1996-2009 by Andrew Tridgell, Wayne Davison, and others.</span><br><span class="line">Web site: http://rsync.samba.org/</span><br><span class="line">Capabilities:</span><br><span class="line">    64-bit files, 64-bit inums, 64-bit timestamps, 64-bit long ints,</span><br><span class="line">    socketpairs, hardlinks, symlinks, IPv6, batchfiles, inplace,</span><br><span class="line">    append, ACLs, xattrs, iconv, symtimes</span><br><span class="line">rsync comes with ABSOLUTELY NO WARRANTY.  This is free software, and you</span><br><span class="line">are welcome to redistribute it under certain conditions.  See the GNU</span><br><span class="line">General Public Licence for details.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="1-3-rsync-软件功能介绍"><a href="#1-3-rsync-软件功能介绍" class="headerlink" title="1.3 rsync 软件功能介绍"></a>1.3 rsync 软件功能介绍</h2><ul>
<li><p><em>类似于 cp 命令 – 实现本地备份传输数据</em></p>
</li>
<li><p><em>类似于scp 命令 – 远程备份传输数据</em></p>
</li>
<li><p><em>类似于 rm 命令 – 实现无差异同步备份</em></p>
</li>
<li><p><em>类似于</em> <em>ls</em> <em>命令</em> <em>–</em> <em>本地文件信息查看</em></p>
</li>
</ul>
<blockquote>
<p>ps</p>
<p>rsync 命令属于1v4 的命令</p>
</blockquote>
<h3 id="1-3-1-rsync-x3D-x3D-cp"><a href="#1-3-1-rsync-x3D-x3D-cp" class="headerlink" title="1.3.1 rsync &#x3D;&#x3D; cp"></a>1.3.1 rsync &#x3D;&#x3D; cp</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# cp -a  /etc/hosts /tmp/</span><br><span class="line">[root@backup ~]# ls /tmp/</span><br><span class="line">hosts</span><br><span class="line">[root@backup ~]# \rm /tmp/hosts</span><br><span class="line">[root@backup ~]# rsync  /etc/hosts /tmp/</span><br><span class="line">[root@backup ~]# ls /tmp/hosts</span><br><span class="line">/tmp/hosts</span><br></pre></td></tr></table></figure>

<h3 id="1-3-2-rsync-x3D-x3D-scp"><a href="#1-3-2-rsync-x3D-x3D-scp" class="headerlink" title="1.3.2 rsync &#x3D;&#x3D; scp"></a>1.3.2 rsync &#x3D;&#x3D; scp</h3><ol>
<li><p>使用scp实现</p>
<p>检查对端服务器目标位置上是否有该文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# ls /tmp/hosts</span><br><span class="line">ls: cannot access /tmp/hosts: No such file or directory</span><br></pre></td></tr></table></figure>

<p>从本地拷贝到远端服务器上</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# ls /tmp/hosts</span><br><span class="line">/tmp/hosts</span><br><span class="line">[root@backup ~]# scp -rp /etc/hosts 10.0.0.31:/tmp/</span><br><span class="line">The authenticity of host &#x27;10.0.0.31 (10.0.0.31)&#x27; can&#x27;t be established.</span><br><span class="line">RSA key fingerprint is d3:41:bb:0d:43:88:da:a3:2c:e8:36:91:11:c9:e4:9c.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added &#x27;10.0.0.31&#x27; (RSA) to the list of known hosts.</span><br><span class="line">root@10.0.0.31&#x27;s password:</span><br><span class="line">hosts                                           100%  357     0.4KB/s   00:00</span><br></pre></td></tr></table></figure>

<p>检查远端服务器上的结果</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# ls /tmp/hosts</span><br><span class="line">/tmp/hosts</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用rsync 实现</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# rsync -rp /etc/hosts 10.0.0.31:/tmp/</span><br><span class="line">root@10.0.0.31&#x27;s password:</span><br><span class="line">[root@backup ~]#</span><br><span class="line">[root@nfs01 ~]# ls /tmp/hosts</span><br><span class="line">/tmp/hosts</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="1-3-3-rsync-x3D-x3D-rm"><a href="#1-3-3-rsync-x3D-x3D-rm" class="headerlink" title="1.3.3 rsync &#x3D;&#x3D; rm"></a>1.3.3 rsync &#x3D;&#x3D; rm</h3><h4 id="1-3-3-1-环境准备"><a href="#1-3-3-1-环境准备" class="headerlink" title="1.3.3.1 环境准备"></a>1.3.3.1 环境准备</h4><p>创建出来一次命令 进行操作</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup tmp]# mkdir /znix</span><br><span class="line">[root@backup znix]# cp /tmp/* .</span><br><span class="line">[root@backup znix]# ll</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root root 357 Oct 11 15:21 hosts</span><br></pre></td></tr></table></figure>

<p>rm命令操作</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup znix]# rm -rf /znix/hosts</span><br><span class="line">[root@backup znix]# ll /znix/hosts</span><br><span class="line">ls: cannot access /znix/hosts: No such file or directory</span><br></pre></td></tr></table></figure>

<p>查看这文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# l</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root root 357 Oct 11 15:21 hosts</span><br></pre></td></tr></table></figure>

<p>创建一个空目录，使用空目录进行无差异同步</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# mkdir /null</span><br><span class="line">[root@backup ~]# rsync --delete  /null/ /znix/</span><br><span class="line">rsync: --delete does not work without -r or -d.</span><br><span class="line">rsync error: syntax or usage error (code 1) at main.c(1422) [client=3.0.6]</span><br><span class="line">[root@backup ~]# rsync  -a  --delete  /null/ /znix/</span><br><span class="line">[root@backup ~]# ll /znix/</span><br><span class="line">total 0</span><br></pre></td></tr></table></figure>

<h3 id="1-3-4-rsync-x3D-x3D-ls-l"><a href="#1-3-4-rsync-x3D-x3D-ls-l" class="headerlink" title="1.3.4 rsync &#x3D;&#x3D; ls -l"></a>1.3.4 rsync &#x3D;&#x3D; ls -l</h3><p>使用rsync 可以实现与 ls 类似的功能</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# ls -l install.log</span><br><span class="line">-rw-r--r--. 1 root root 21736 Sep 25 08:38 install.log</span><br><span class="line">[root@backup ~]# rsync install.log</span><br><span class="line">-rw-r--r--       21736 2017/09/25 08:38:28 install.log</span><br></pre></td></tr></table></figure>

<h2 id="1-4-Rsync的特性总结（7个特性信息说明）"><a href="#1-4-Rsync的特性总结（7个特性信息说明）" class="headerlink" title="1.4 Rsync的特性总结（7个特性信息说明）"></a>1.4 Rsync的特性总结（7个特性信息说明）</h2><ol>
<li><p>支持拷贝普通文件与特殊文件如链接文件，设备等。</p>
</li>
<li><p>可以有排除指定文件或目录同步的功能，相当于打包命令tar的排除功能。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar zcvf backup_1.tar.gz /opt/data -exclude=clsn  </span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：</p>
<p>在打包&#x2F;opt&#x2F;data时就排除了clsn命名的目录和文件。 </p>
</blockquote>
</li>
<li><p>可以做到保持原文件或目录的权限、时间、软硬链接、属主、组等所有属性均不改变-p。</p>
</li>
<li><p>可实现增量同步，既只同步发生变化的数据，因此数据传输效率很高（tar -N）。<br> 将备份&#x2F;home 目录自 2008-01-29 以来修改过的文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar -N 2008-01-29 -zcvf /backups/inc-backup_$(date +%F).tar.gz /home</span><br></pre></td></tr></table></figure>

<p> 将备份 &#x2F;home 目录昨天以来修改过的文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar -N $(date -d yesterday &quot;+%F&quot;) -zcvf /backups/inc-backup_$(date +%F).tar.gz /home</span><br></pre></td></tr></table></figure>

<p>添加文件到已经打包的文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar -rf all.tar *.gif</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：</p>
<p>这条命令是将所有.gif的文件增加到all.tar的包里面去。-r是表示增加文件的意思。</p>
</blockquote>
</li>
<li><p>可以使用rcp,rsh,ssh等方式来配合进行隧道加密传输文件（rsync本身不对数据加密）</p>
</li>
<li><p>可以通过socket(进程方式)传输文件和数据（服务端和客户端）* * * * *。重点掌握</p>
</li>
<li><p>支持匿名的或认证（无需系统用户）的进程模式传输，可实现方便安全的进行数据备份及镜像。</p>
</li>
</ol>
<h2 id="1-5-Rsync的企业工作场景说明"><a href="#1-5-Rsync的企业工作场景说明" class="headerlink" title="1.5 Rsync的企业工作场景说明"></a>1.5 Rsync的企业工作场景说明</h2><ol>
<li><p>两台服务器之间数据同步（定时任务cron+rsync)</p>
<p>同步网站内部人员数据信息（定时任务最小周期为1分钟）</p>
</li>
<li><p>两台服务器之间数据同步（实时任务inotify&#x2F;sersync&#x2F;lrsyncd+rsync）同步网站用户人员数据信息</p>
</li>
</ol>
<h1 id="第2章-rsync使用方式"><a href="#第2章-rsync使用方式" class="headerlink" title="第2章 rsync使用方式"></a>第2章 rsync使用方式</h1><h2 id="2-1-rsync软件工作方式"><a href="#2-1-rsync软件工作方式" class="headerlink" title="2.1 rsync软件工作方式"></a>2.1 rsync软件工作方式</h2><p>SYNOPSIS</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">本地数据同步方式</span><br><span class="line">Local:  rsync [OPTION...] SRC... [DEST]</span><br><span class="line">远程数据同步方式</span><br><span class="line">Access via remote shell:</span><br><span class="line">Pull: rsync [OPTION...] [USER@]HOST:SRC... [DEST]</span><br><span class="line">Push: rsync [OPTION...] SRC... [USER@]HOST:DEST</span><br><span class="line">守护进程方式同步数据</span><br><span class="line">Access via rsync daemon:</span><br><span class="line">Pull: rsync [OPTION...] [USER@]HOST::SRC... [DEST]</span><br><span class="line">      rsync [OPTION...] rsync://[USER@]HOST[:PORT]/SRC... [DEST]</span><br><span class="line">Push: rsync [OPTION...] SRC... [USER@]HOST::DEST</span><br><span class="line">      rsync [OPTION...] SRC... rsync://[USER@]HOST[:PORT]/DEST</span><br></pre></td></tr></table></figure>

<h3 id="2-1-1-本地数据同步方式（类似于cp）"><a href="#2-1-1-本地数据同步方式（类似于cp）" class="headerlink" title="2.1.1 本地数据同步方式（类似于cp）"></a>2.1.1 本地数据同步方式（类似于cp）</h3><p>Local: rsync [OPTION…] SRC… [DEST]</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>rsync</td>
<td>数据同步命令</td>
</tr>
<tr>
<td>[OPTION…]</td>
<td>rsync命令参数信息</td>
</tr>
<tr>
<td>SRC</td>
<td>要同不得数据信息（文件或目录）</td>
</tr>
<tr>
<td>[DEST]</td>
<td>将数据传输到什么位置</td>
</tr>
</tbody></table>
<h4 id="2-1-1-1-实例演示命令："><a href="#2-1-1-1-实例演示命令：" class="headerlink" title="2.1.1.1 实例演示命令："></a><strong>2.1.1.1</strong> 实例演示命令：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# rsync  /etc/hosts /tmp/</span><br><span class="line">[root@backup ~]# ls /tmp/hosts</span><br><span class="line">/tmp/hosts</span><br></pre></td></tr></table></figure>

<h3 id="2-1-2-远程数据同步方式（类似scp）—又称为隧道传输"><a href="#2-1-2-远程数据同步方式（类似scp）—又称为隧道传输" class="headerlink" title="2.1.2 远程数据同步方式（类似scp）—又称为隧道传输"></a><strong>2.1.2</strong> 远程数据同步方式（类似scp）—又称为隧道传输</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Access via remote shell:</span><br><span class="line">  Pull: rsync [OPTION...] [USER@]HOST:SRC... [DEST]</span><br><span class="line">  Push: rsync [OPTION...] SRC... [USER@]HOST:DEST</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：</p>
<p>需要进行交互传输数据。如果想实现免交互传输数据，需要借助ssh+key方式实现</p>
</blockquote>
<table>
<thead>
<tr>
<th><em><strong>pull：拉：</strong></em></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>[USER@] ：</td>
<td>以什么用户身份传输数据信息</td>
</tr>
<tr>
<td>HOST:</td>
<td>远程主机信息（IP地址信息 主机名称信息）</td>
</tr>
<tr>
<td>SRC:</td>
<td>远端要恏过来的数据信息</td>
</tr>
<tr>
<td>[dest]</td>
<td>恏到本地什么位置</td>
</tr>
<tr>
<td><em><strong>push：推：</strong></em></td>
<td></td>
</tr>
<tr>
<td>SRC：</td>
<td>本地要怼过去的数据信息</td>
</tr>
<tr>
<td>DEST</td>
<td>怼到远端什么位置</td>
</tr>
</tbody></table>
<h3 id="2-1-3-【实践操作】pull拉"><a href="#2-1-3-【实践操作】pull拉" class="headerlink" title="2.1.3 【实践操作】pull拉"></a><strong>2.1.3</strong> 【实践操作】pull拉</h3><p>从远端拉文件到当前目录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# touch /tmp/1.txt</span><br><span class="line">[root@backup ~]# rsync nfs01:/tmp/1.txt .</span><br><span class="line">root@nfs01&#x27;s password:</span><br><span class="line">[root@backup ~]# ll</span><br><span class="line">total 44</span><br><span class="line">-rw-r--r--  1 root root     0 Oct 11 16:16 1.txt</span><br></pre></td></tr></table></figure>

<h3 id="2-1-4-【实践操作】push推（目录）"><a href="#2-1-4-【实践操作】push推（目录）" class="headerlink" title="2.1.4 【实践操作】push推（目录）"></a><strong>2.1.4</strong> 【实践操作】push推（目录）</h3><ol>
<li><p>将本地的hosts文件推到远端服务器上</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup tmp]# ll</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root root 357 Oct 11 15:12 hosts</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用push的格式 推整个目录（包括目录）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup tmp]# rsync -r /tmp nfs01:/tmp/</span><br><span class="line">root@nfs01&#x27;s password:</span><br><span class="line">[root@nfs01 tmp]# ll</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x 3 root root 4096 Oct 11 16:20 tmp</span><br></pre></td></tr></table></figure>
</li>
<li><p>推整个目录下的文件（不包括目录本身）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup tmp]# rsync -r /tmp/ nfs01:/tmp/</span><br><span class="line">root@nfs01&#x27;s password:</span><br><span class="line">[root@nfs01 tmp]# ll</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 root root  357 Oct 11 16:21 hosts</span><br><span class="line">drwxr-xr-x 3 root root 4096 Oct 11 16:20 tmp</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：</p>
<p><em>&#x2F;tmp  –表示将tmp目录本身及目录下的内容进行传输</em></p>
<p><em>&#x2F;tmp&#x2F; –表示只传输**tmp目录下面的内容信息</em></p>
</blockquote>
</li>
</ol>
<h2 id="2-2-守护进程方式同步数据"><a href="#2-2-守护进程方式同步数据" class="headerlink" title="2.2 守护进程方式同步数据"></a><strong>2.2</strong> <strong>守护进程方式同步数据</strong></h2><p>[root@localhost ~]# uname -a<br> Linux 2.6.32-696.el6.x86_64 #1 SMP Tue Mar 21 19:29:05 UTC 2017 x86_64 x86_64 x86_64 GNU&#x2F;Linux<br> Access via rsync daemon:<br> Pull: rsync [OPTION…] [USER@]HOST::SRC… [DEST]<br>    rsync [OPTION…] rsync:&#x2F;&#x2F;[USER@]HOST[:PORT]&#x2F;SRC… [DEST]<br> Push: rsync [OPTION…] SRC… [USER@]HOST::DEST<br>    rsync [OPTION…] SRC… rsync:&#x2F;&#x2F;[USER@]HOST[:PORT]&#x2F;DEST</p>
<h3 id="2-2-1-配置rsync守护进程方式（需要有服务端与客户端）"><a href="#2-2-1-配置rsync守护进程方式（需要有服务端与客户端）" class="headerlink" title="2.2.1 配置rsync守护进程方式（需要有服务端与客户端）"></a><strong>2.2.1</strong> <strong>配置</strong>rsync守护进程方式（需要有服务端与客户端）</h3><p>规划：</p>
<p>  <em>1. backup服务器作为rsync服务端</em></p>
<p>  <em>2. 以rysnc客户端作为参照物，将数据推到rsync服务器上</em></p>
<h3 id="2-2-2-配置rsync服务端（将服务端配置到-backup-服务器上）"><a href="#2-2-2-配置rsync服务端（将服务端配置到-backup-服务器上）" class="headerlink" title="2.2.2 配置rsync服务端（将服务端配置到 backup 服务器上）"></a><strong>2.2.2</strong> 配置rsync服务端（将服务端配置到 <strong>backup</strong> 服务器上）</h3><h4 id="第一个里程碑：-软件是否存在"><a href="#第一个里程碑：-软件是否存在" class="headerlink" title="第一个里程碑： 软件是否存在"></a>第一个里程碑： 软件是否存在</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# rpm -qa |grep rsync</span><br><span class="line">rsync-3.0.6-12.el6.x86_64</span><br></pre></td></tr></table></figure>

<h4 id="第二个里程碑：-进行软件服务配置"><a href="#第二个里程碑：-进行软件服务配置" class="headerlink" title="第二个里程碑： 进行软件服务配置"></a>第二个里程碑： 进行软件服务配置</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# vim /etc/rsyncd.conf</span><br><span class="line">uid = rsync             //指定管理备份目录的用户</span><br><span class="line">gid = rsync             //指定管理备份目录的用户组</span><br><span class="line">port=873                //定义rsync备份服务的网络端口号</span><br><span class="line">fake super=yes          //伪装root用户(无需让rsync以root身份运行，允许存储文件的完整属性)</span><br><span class="line">use chroot = no         //和安全相关的配置</span><br><span class="line">max connections = 200   //最大连接数  同时自能有200个客户端连接到备份服务器</span><br><span class="line">timeout = 300           //超时时间（单位秒）</span><br><span class="line">pid file = /var/run/rsyncd.pid         //记录进程号码信息 1.让程序快速停止进程  2.判断一个服务是否正在运行</span><br><span class="line">lock file = /var/run/rsync.lock        //锁文件 保证文件到达限制后无法再进行连接</span><br><span class="line">log file = /var/log/rsyncd.log         //rsync服务的日志文件  用于排除分析问题</span><br><span class="line">ignore errors                          //忽略传输文件中的简单错误</span><br><span class="line">read only = false                //指定备份目录是可读可写</span><br><span class="line">list = false                     //使客户端可以查看服务器的模块信息</span><br><span class="line">hosts allow = 172.16.1.0/24      //允许传输备份数据的主机（白名单）</span><br><span class="line">hosts deny = 0.0.0.0/32          //禁止传输备份数据的主机（黑名单）</span><br><span class="line">auth users = rsync_backup        //指定认证用户</span><br><span class="line">secrets file = /etc/rsync.password     //指定认证用户密码文件  用户名称：密码信息</span><br><span class="line">[backup]                         //模块信息</span><br><span class="line">comment = &quot;backup dir by clsn&quot;                                   </span><br><span class="line">path = /backup          //模块中备份参数  指定备份目录</span><br></pre></td></tr></table></figure>

<h4 id="第三个里程：创建rsync用户"><a href="#第三个里程：创建rsync用户" class="headerlink" title="第三个里程：创建rsync用户"></a>第三个里程：创建rsync用户</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# id rsync</span><br><span class="line">id: rsync: No such user</span><br><span class="line">[root@backup ~]# useradd -s /sbin/nologin -M rsync</span><br></pre></td></tr></table></figure>

<h4 id="第四个里程碑：-创建数据备份储存目录-目录修改属主"><a href="#第四个里程碑：-创建数据备份储存目录-目录修改属主" class="headerlink" title="第四个里程碑： 创建数据备份储存目录,目录修改属主"></a>第四个里程碑： 创建数据备份储存目录,目录修改属主</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# mkdir /backup/</span><br><span class="line">[root@backup ~]# chown -R rsync.rsync /backup/</span><br></pre></td></tr></table></figure>

<h4 id="第五个里程碑：-创建认证用户密码文件"><a href="#第五个里程碑：-创建认证用户密码文件" class="headerlink" title="第五个里程碑： 创建认证用户密码文件"></a>第五个里程碑： 创建认证用户密码文件</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &quot;rsync_backup:clsn123&quot; &gt;&gt;/etc/rsync.password</span><br><span class="line">chmod 600 /etc/rsync.password</span><br></pre></td></tr></table></figure>

<h4 id="第六个里程碑：-启动rsync服"><a href="#第六个里程碑：-启动rsync服" class="headerlink" title="第六个里程碑： 启动rsync服"></a>第六个里程碑： 启动rsync服</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rsync --daemon</span><br></pre></td></tr></table></figure>

<h4 id="至此服务端配置完成"><a href="#至此服务端配置完成" class="headerlink" title="至此服务端配置完成"></a>至此服务端配置完成</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# ps -ef |grep rsync</span><br><span class="line">root       2076      1  0 17:05 ?        00:00:00 rsync --daemon</span><br><span class="line">root       2163   1817  0 17:38 pts/1    00:00:00 grep --color=auto rsync</span><br><span class="line">[root@backup ~]# netstat -lntup |grep rsync</span><br><span class="line">tcp        0      0 0.0.0.0:873                 0.0.0.0:*                   LISTEN      2076/rsync         </span><br><span class="line">tcp        0      0 :::873                      :::*                        LISTEN      2076/rsync </span><br></pre></td></tr></table></figure>

<h3 id="2-2-3-配置rsync客户端（其他服务器为客户端）"><a href="#2-2-3-配置rsync客户端（其他服务器为客户端）" class="headerlink" title="2.2.3 配置rsync客户端（其他服务器为客户端）"></a><strong>2.2.3</strong> 配置rsync客户端（其他服务器为客户端）</h3><h4 id="第一个里程碑：-软件是否存在-1"><a href="#第一个里程碑：-软件是否存在-1" class="headerlink" title="第一个里程碑： 软件是否存在"></a>第一个里程碑： 软件是否存在</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# rpm -qa |grep rsync</span><br><span class="line">rsync-3.0.6-12.el6.x86_64</span><br></pre></td></tr></table></figure>

<h4 id="第二个里程碑：-创建认证文件"><a href="#第二个里程碑：-创建认证文件" class="headerlink" title="第二个里程碑： 创建认证文件"></a>第二个里程碑： 创建认证文件</h4><p>客户端的认证文件只需要有密码即可</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &quot;clsn123&quot; &gt;&gt;/etc/rsync.password</span><br><span class="line">chmod 600 /etc/rsync.password</span><br></pre></td></tr></table></figure>

<h4 id="第三个里程碑：-实现数据传输"><a href="#第三个里程碑：-实现数据传输" class="headerlink" title="第三个里程碑： 实现数据传输"></a>第三个里程碑： 实现数据传输</h4><h5 id="交互式"><a href="#交互式" class="headerlink" title="交互式"></a>交互式</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# rsync -avzP /etc/hosts rsync_backup@172.16.1.41::backup</span><br><span class="line">Password:</span><br><span class="line">sending incremental file list</span><br><span class="line">hosts</span><br><span class="line">         357 100%    0.00kB/s    0:00:00 (xfer#1, to-check=0/1)</span><br><span class="line"> </span><br><span class="line">sent 63 bytes  received 33 bytes  9.14 bytes/sec</span><br><span class="line">total size is 357  speedup is 3.72</span><br></pre></td></tr></table></figure>

<h5 id="免交互式"><a href="#免交互式" class="headerlink" title="免交互式"></a>免交互式</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# rsync -avzP /etc/hosts rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password</span><br><span class="line">sending incremental file list</span><br><span class="line">hosts</span><br><span class="line">         357 100%    0.00kB/s    0:00:00 (xfer#1, to-check=0/1)</span><br><span class="line"> </span><br><span class="line">sent 199 bytes  received 27 bytes  150.67 bytes/sec</span><br><span class="line">total size is 357  speedup is 1.58</span><br></pre></td></tr></table></figure>

<h2 id="2-3-rsync守护进程传输数据原理"><a href="#2-3-rsync守护进程传输数据原理" class="headerlink" title="2.3 rsync守护进程传输数据原理"></a>2.3 rsync守护进程传输数据原理</h2><p><img src="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/2.3rsync%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E4%BC%A0%E8%BE%93%E6%95%B0%E6%8D%AE%E5%8E%9F%E7%90%86.png" alt="2.3 rsync守护进程传输数据原理"></p>
<h2 id="2-4-rsync-命令同步参数选项-amp-特殊参数"><a href="#2-4-rsync-命令同步参数选项-amp-特殊参数" class="headerlink" title="2.4 rsync 命令同步参数选项&amp;特殊参数"></a><strong>2.4 rsync</strong> 命令同步参数选项&amp;特殊参数</h2><table>
<thead>
<tr>
<th><strong>目录参数</strong></th>
<th><strong>参数说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>-v ,–verbose</td>
<td>详细模式输出，传输时的信息</td>
</tr>
<tr>
<td>-z,–compress</td>
<td>传输时进行压缩以提高传输效率  –compress-level&#x3D;NUM 可按级别压缩  局域网可以不用压缩</td>
</tr>
<tr>
<td>-a,–archive （主要）</td>
<td>归档模式，表示以递归方式传输文件，并保持文件属性。等于 -rtopgDl</td>
</tr>
<tr>
<td>-r,–recursive <strong>归档于</strong><strong>-a</strong></td>
<td>对子目录以递归模式，即目录下的所有目录都同样传输。小写r</td>
</tr>
<tr>
<td>-t,–times    <strong>归档于</strong><strong>-a</strong></td>
<td>保持文件时间信息(修改时间)</td>
</tr>
<tr>
<td>-o,–owner    <strong>归档于</strong><strong>-a</strong></td>
<td>保持文件属主信息</td>
</tr>
<tr>
<td>-p,–perms    <strong>归档于</strong><strong>-a</strong></td>
<td>保持文件权限</td>
</tr>
<tr>
<td>-g,–group    <strong>归档于</strong><strong>-a</strong></td>
<td>保持文件属组信息</td>
</tr>
<tr>
<td>-P，–progress</td>
<td>显示同步的过程及传输时的进度等信息（大P）</td>
</tr>
<tr>
<td>-D,–devices  <strong>归档于</strong><strong>-a</strong></td>
<td>保持设备文件信息</td>
</tr>
<tr>
<td>-l,–links    <strong>归档于</strong><strong>-a</strong></td>
<td>保留软连接（小写字母l）</td>
</tr>
<tr>
<td>-L</td>
<td>保持链接文件数据信息不变</td>
</tr>
<tr>
<td>-e，–rsh&#x3D;COMMAND</td>
<td>使用的信道协议（remote  shell），指定替代rsh的shell程序。  例如 ssh</td>
</tr>
<tr>
<td>–exclude&#x3D;<em>PATTERN</em></td>
<td>指定排除不需要传输的文件信息</td>
</tr>
<tr>
<td>–exclude-from&#x3D;<em>file</em></td>
<td>文件名所在目录文件，即可以实现排除多个文件</td>
</tr>
<tr>
<td>–bwlimit&#x3D;RATE</td>
<td>限速功能</td>
</tr>
<tr>
<td>–delete</td>
<td>让目标目录SRC和源目录数据DST一致，即无差异数据同步</td>
</tr>
<tr>
<td><strong>保持同步目录及文件属性：</strong>  这里的-avzP相当于 -vzetopdDlP，生产环境常用的参数为 -avzP  在脚本中可以报-vP去掉  –progress可以用-P代替</td>
<td></td>
</tr>
<tr>
<td><strong>daemon****启动扩展参数</strong></td>
<td></td>
</tr>
<tr>
<td>–daemon</td>
<td>daemon表示以守护进程的方式启动rsync服务。</td>
</tr>
<tr>
<td>–address</td>
<td>绑定指定IP地址提供服务。</td>
</tr>
<tr>
<td>–config&#x3D;FILE</td>
<td>更改配置文件路径，而不是默认的&#x2F;etc&#x2F;rsyncd.conf</td>
</tr>
<tr>
<td>–port&#x3D;PORT</td>
<td>更改其它端口提供服务，而不是缺省的873端口</td>
</tr>
</tbody></table>
<h3 id="2-4-1-特殊参数实践"><a href="#2-4-1-特殊参数实践" class="headerlink" title="2.4.1 特殊参数实践"></a><strong>2.4.1</strong> 特殊参数实践</h3><h4 id="指定ip"><a href="#指定ip" class="headerlink" title="指定ip"></a>指定ip</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# rsync --daemon --address=172.16.1.41</span><br><span class="line">[root@backup ~]# netstat -lntup |grep 873</span><br><span class="line">tcp     0   0 172.16.1.41:873     0.0.0.0:*        LISTEN      2583/rsync   </span><br></pre></td></tr></table></figure>

<h4 id="参数测试"><a href="#参数测试" class="headerlink" title="参数测试"></a>参数测试</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password</span><br><span class="line">sending incremental file list</span><br><span class="line">services</span><br><span class="line">      641020 100%   19.34MB/s    0:00:00 (xfer#1, to-check=0/1)</span><br><span class="line"> </span><br><span class="line">sent 127417 bytes  received 27 bytes  254888.00 bytes/sec</span><br><span class="line">total size is 641020  speedup is 5.03</span><br></pre></td></tr></table></figure>

<h4 id="指定配置文件路径"><a href="#指定配置文件路径" class="headerlink" title="指定配置文件路径"></a>指定配置文件路径</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# rsync --daemon --config=/etc/rsyncd.conf</span><br><span class="line">[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password</span><br><span class="line">sending incremental file list</span><br><span class="line">sent 29 bytes  received 8 bytes  74.00 bytes/sec</span><br><span class="line">total size is 641020  speedup is 17324.86</span><br></pre></td></tr></table></figure>

<h4 id="服务端指定服务端口"><a href="#服务端指定服务端口" class="headerlink" title="服务端指定服务端口"></a>服务端指定服务端口</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# rsync --daemon --port=5222</span><br><span class="line">[root@backup ~]# netstat -lntup|grep rsync</span><br><span class="line">tcp        0      0 0.0.0.0:5222      0.0.0.0:*           LISTEN      2598/rsync         </span><br><span class="line">tcp        0      0 :::5222            :::*                 LISTEN      2598/rsync  </span><br></pre></td></tr></table></figure>

<h3 id="2-4-2-命令小结"><a href="#2-4-2-命令小结" class="headerlink" title="2.4.2 命令小结"></a><strong>2.4.2</strong> 命令小结</h3><p>让文件权限不改变：</p>
<p>​       让-o和-g参数生效，需要将配置文件uid和gid改为root，然后将fake super参数进行注释</p>
<h1 id="第3章-rsycn配置文件详解rsyncd-conf"><a href="#第3章-rsycn配置文件详解rsyncd-conf" class="headerlink" title="第3章 rsycn配置文件详解rsyncd.conf"></a>第3章 rsycn配置文件详解rsyncd.conf</h1><h2 id="3-1-部分知识补充"><a href="#3-1-部分知识补充" class="headerlink" title="3.1 部分知识补充"></a><strong>3.1</strong> 部分知识补充</h2><h3 id="3-1-1-配置文件内容参考资料"><a href="#3-1-1-配置文件内容参考资料" class="headerlink" title="3.1.1 配置文件内容参考资料"></a><strong>3.1.1</strong> 配置文件内容参考资料</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">man rsyncd.conf</span><br></pre></td></tr></table></figure>

<h3 id="3-1-2-配置文件内容总结"><a href="#3-1-2-配置文件内容总结" class="headerlink" title="3.1.2 配置文件内容总结"></a><strong>3.1.2</strong> 配置文件内容总结</h3><p>模块之上内容为全局变量信息</p>
<p>模块之下内容为局部变量信息</p>
<blockquote>
<p><strong>说明：</strong></p>
<p>无论是全局变量发生变化，还是局部变量发生变化，都建议重启rsync服务使配置生效。</p>
</blockquote>
<h2 id="3-2-利用-x2F-etc-x2F-init-d-x2F-启动rsync服务方式"><a href="#3-2-利用-x2F-etc-x2F-init-d-x2F-启动rsync服务方式" class="headerlink" title="3.2 利用&#x2F;etc&#x2F;init.d&#x2F;启动rsync服务方式"></a><strong>3.2</strong> 利用&#x2F;etc&#x2F;init.d&#x2F;启动rsync服务方式</h2><h3 id="3-2-1-可以实现方式："><a href="#3-2-1-可以实现方式：" class="headerlink" title="3.2.1 可以实现方式："></a><strong>3.2.1</strong> 可以实现方式：</h3><ol>
<li>编写rsync启动脚本（有一定的shell能力 if case）</li>
<li>利用xinetd服务，管理启动rsync服务</li>
</ol>
<h3 id="3-2-2-利用xinetd服务管理rsync"><a href="#3-2-2-利用xinetd服务管理rsync" class="headerlink" title="3.2.2 利用xinetd服务管理rsync"></a><strong>3.2.2</strong> 利用xinetd服务管理rsync</h3><h4 id="第一个里程碑：-安装xinetd软件"><a href="#第一个里程碑：-安装xinetd软件" class="headerlink" title="第一个里程碑： 安装xinetd软件"></a>第一个里程碑： 安装xinetd软件</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# yum install -y xinetd</span><br><span class="line">[root@backup ~]# rpm -qa |grep xin</span><br><span class="line">xinetd-2.3.14-40.el6.x86_64</span><br></pre></td></tr></table></figure>

<h4 id="第二个里程碑：编辑配置文件"><a href="#第二个里程碑：编辑配置文件" class="headerlink" title="第二个里程碑：编辑配置文件"></a>第二个里程碑：编辑配置文件</h4><p>修改disable &#x3D; yes 改为disable &#x3D; no</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# vim /etc/xinetd.d/rsync</span><br><span class="line"># default: off</span><br><span class="line"># description: The rsync server is a good addition to an ftp server, as it \</span><br><span class="line">#   allows crc checksumming etc.</span><br><span class="line">service rsync</span><br><span class="line">&#123;</span><br><span class="line">disable   = no</span><br><span class="line">flags     = IPv6</span><br><span class="line">socket_type     = stream</span><br><span class="line">wait            = no</span><br><span class="line">user            = root</span><br><span class="line">server          = /usr/bin/rsync</span><br><span class="line">server_args     = --daemon</span><br><span class="line">log_on_failure  += USERID</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="第三个里程碑：重启xinetd服务"><a href="#第三个里程碑：重启xinetd服务" class="headerlink" title="第三个里程碑：重启xinetd服务"></a>第三个里程碑：重启xinetd服务</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# /etc/init.d/xinetd restart</span><br><span class="line">Stopping xinetd:                                           [  OK  ]</span><br><span class="line">Starting xinetd:                                           [  OK  ]</span><br></pre></td></tr></table></figure>

<h4 id="传输测试"><a href="#传输测试" class="headerlink" title="传输测试"></a>传输测试</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password</span><br><span class="line">sending incremental file list</span><br><span class="line">sent 29 bytes  received 8 bytes  74.00 bytes/sec</span><br><span class="line">total size is 641020  speedup is 17324.86</span><br></pre></td></tr></table></figure>

<h2 id="定义变量信息实现免秘钥交互"><a href="#定义变量信息实现免秘钥交互" class="headerlink" title="定义变量信息实现免秘钥交互"></a>定义变量信息实现免秘钥交互</h2><h3 id="3-3-1-通过man手册获得方法"><a href="#3-3-1-通过man手册获得方法" class="headerlink" title="3.3.1 通过man手册获得方法"></a><strong>3.3.1</strong> 通过man手册获得方法</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Some  modules  on the remote daemon may require authentication. If so, you will receive a password prompt when you connect.  You  can avoid  the  password  prompt  by  setting the environment variable RSYNC_PASSWORD to the password  you  want  to  use  or  using  the --password-file option. This may be useful when scripting rsync.</span><br><span class="line">WARNING:  On some systems environment variables are visible to all users. On those systems using --password-file is recommended.</span><br></pre></td></tr></table></figure>

<p>在远程进程的一些模块可能需要认证。如果是这样的话，你将得到一个密码提示当您连接。你可以通过设置环境变量rsync_password要使用或使用密码文件选项密码避免密码提示。这可能是有用的脚本文件。</p>
<blockquote>
<p>警告：</p>
<p>在一些系统环境变量，对所有用户都是可见的。在这些系统中使用的密码文件的建议。</p>
</blockquote>
<h3 id="3-3-2-使用RSYNC-PASSWORD-变量实现免交互"><a href="#3-3-2-使用RSYNC-PASSWORD-变量实现免交互" class="headerlink" title="3.3.2 使用RSYNC_PASSWORD 变量实现免交互"></a><strong>3.3.2</strong> 使用RSYNC_PASSWORD 变量实现免交互</h3><p>未设置变量之前</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup</span><br><span class="line">Password:</span><br></pre></td></tr></table></figure>

<p>添加上环境变量</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# export RSYNC_PASSWORD=clsn123</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup</span><br><span class="line">sending incremental file list</span><br><span class="line">sent 29 bytes  received 8 bytes  24.67 bytes/sec</span><br><span class="line">total size is 641020  speedup is 17324.86</span><br></pre></td></tr></table></figure>

<h3 id="3-3-3-使用-rsync-password文件实现免交互"><a href="#3-3-3-使用-rsync-password文件实现免交互" class="headerlink" title="3.3.3 使用 rsync.password文件实现免交互"></a><strong>3.3.3</strong> <strong>使用</strong> rsync.password文件实现免交互</h3><p>建立密码文档</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# echo &quot;123456&quot;&gt;/etc/rsync.password</span><br><span class="line">[root@nfs01 ~]# chmod 600 /etc/rsync.password</span><br></pre></td></tr></table></figure>

<p>命令测试</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# rsync -avz /etc/hosts rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password </span><br></pre></td></tr></table></figure>

<h2 id="3-4-守护进程多模块功能配置"><a href="#3-4-守护进程多模块功能配置" class="headerlink" title="3.4 守护进程多模块功能配置"></a><strong>3.4</strong> 守护进程多模块功能配置</h2><h3 id="第一个里程碑：-编写配置信息创建多模块"><a href="#第一个里程碑：-编写配置信息创建多模块" class="headerlink" title="第一个里程碑： 编写配置信息创建多模块"></a>第一个里程碑： 编写配置信息创建多模块</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# vim /etc/rsyncd.conf</span><br><span class="line">……</span><br><span class="line">[nfsdata]</span><br><span class="line">comment = &quot;nfsdata dir by clsn&quot;</span><br><span class="line">path = /backup/nfsdata</span><br><span class="line">[nfsbackup]</span><br><span class="line">comment = &quot;nfsbackup dir by clsn&quot;</span><br><span class="line">path = /backup/nfsbackup </span><br></pre></td></tr></table></figure>

<h3 id="第二个里程碑：-创建多模块指定的目录"><a href="#第二个里程碑：-创建多模块指定的目录" class="headerlink" title="第二个里程碑： 创建多模块指定的目录"></a>第二个里程碑： 创建多模块指定的目录</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 创建目录，并修改目录的权限</span><br><span class="line">[root@backup ~]# mkdir /backup/nfs&#123;data,backup&#125; -p</span><br><span class="line">[root@backup ~]# chown rsync.rsync  /backup/nfs&#123;data,backup&#125;</span><br><span class="line">#查看：</span><br><span class="line">[root@backup ~]# ll /backup/nfs&#123;data,backup&#125; -d</span><br><span class="line">drwxr-xr-x 2 rsync rsync 4096 Oct 12 10:05 /backup/nfsbackup</span><br><span class="line">drwxr-xr-x 2 rsync rsync 4096 Oct 12 10:05 /backup/nfsdata</span><br></pre></td></tr></table></figure>

<h3 id="第三里程碑：-利用rsync客户端进行测试"><a href="#第三里程碑：-利用rsync客户端进行测试" class="headerlink" title="第三里程碑： 利用rsync客户端进行测试"></a>第三里程碑： 利用rsync客户端进行测试</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# rsync -avz /data/ rsync_backup@172.16.1.41::nfsdata --password-file=/etc/rsync.passsword</span><br><span class="line">sending incremental file list</span><br><span class="line">./</span><br><span class="line">nfs.data</span><br><span class="line">sent 78 bytes  received 30 bytes  216.00 bytes/sec</span><br><span class="line">total size is 0  speedup is 0.00</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：</p>
<p><em>rsyncd.conf配置文件中，添加多模块信息，可以不用重启rsync服务，即时生效~</em></p>
<p><em>全局变量参数针对所有模块生效；局部变量参数只针对指定模块生效</em></p>
<p><em>read only参数默认配置为ture，即为只读模式</em></p>
<p><em>全局变量发生变化，不用重启<strong>rsync</strong>服务；局部变量发生变化，需要重启<strong>rsync</strong>服务</em></p>
</blockquote>
<blockquote>
<p>注意：修改配置文件就重启<strong>↓</strong></p>
<p>无论是全局变量发生变化，还是局部变量发生变化，都建议重启rsync服务使配置生效</p>
</blockquote>
<h2 id="3-5-守护进程的排除功能实践"><a href="#3-5-守护进程的排除功能实践" class="headerlink" title="3.5 守护进程的排除功能实践"></a><strong>3.5</strong> 守护进程的排除功能实践</h2><h3 id="3-5-1-排除的方式"><a href="#3-5-1-排除的方式" class="headerlink" title="3.5.1 排除的方式"></a><strong>3.5.1</strong> 排除的方式</h3><ol>
<li>–exclude&#x3D;要配置的目录或文件名称</li>
<li>–exclude-from&#x3D;要排除多个目录或文件汇总文件名称</li>
<li>在配置文件中进行修改，指定要排除的信息</li>
</ol>
<h3 id="3-5-2-排除测试"><a href="#3-5-2-排除测试" class="headerlink" title="3.5.2 排除测试"></a><strong>3.5.2</strong> 排除测试</h3><h4 id="第一个里程碑-创建模拟测试环境"><a href="#第一个里程碑-创建模拟测试环境" class="headerlink" title="第一个里程碑: 创建模拟测试环境"></a>第一个里程碑: 创建模拟测试环境</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 data]# mkdir &#123;a..d&#125;</span><br><span class="line">[root@nfs01 data]# touch &#123;a..d&#125;/&#123;1..3&#125;.txt</span><br><span class="line">[root@nfs01 data]# tree</span><br><span class="line">.</span><br><span class="line">├── a</span><br><span class="line">│   ├── 1.txt</span><br><span class="line">│   ├── 2.txt</span><br><span class="line">│   └── 3.txt</span><br><span class="line">├── b</span><br><span class="line">│   ├── 1.txt</span><br><span class="line">│   ├── 2.txt</span><br><span class="line">│   └── 3.txt</span><br><span class="line">├── c</span><br><span class="line">│   ├── 1.txt</span><br><span class="line">│   ├── 2.txt</span><br><span class="line">│   └── 3.txt</span><br><span class="line">└── d</span><br><span class="line">    ├── 1.txt</span><br><span class="line">    ├── 2.txt</span><br><span class="line">    └── 3.txt</span><br><span class="line">4 directories, 12 files</span><br></pre></td></tr></table></figure>

<h4 id="第二个里程碑-利用-–exclude参数测试排除功能"><a href="#第二个里程碑-利用-–exclude参数测试排除功能" class="headerlink" title="第二个里程碑 利用 –exclude参数测试排除功能"></a>第二个里程碑 利用 –exclude参数测试排除功能</h4><p># 需求：不要a目录中3.txt 不要b、c目录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 data]# rsync -avz /data/ --exclude=a/3.txt --exclude=b --exclude=c rsync_backup@172.16.1.41::nfsdata</span><br><span class="line">sending incremental file list</span><br><span class="line">./</span><br><span class="line">a/</span><br><span class="line">a/1.txt</span><br><span class="line">a/2.txt</span><br><span class="line">d/</span><br><span class="line">d/1.txt</span><br><span class="line">d/2.txt</span><br><span class="line">d/3.txt</span><br><span class="line">sent 300 bytes  received 114 bytes  828.00 bytes/sec</span><br><span class="line">total size is 0  speedup is 0.00</span><br></pre></td></tr></table></figure>

<p>精简方式排除</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 data]# rsync -avz /data/ --exclude=a/3.txt --exclude=&#123;b,c&#125; rsync_backup@172.16.1.41::nfsdata</span><br><span class="line">sending incremental file list</span><br><span class="line">./</span><br><span class="line">a/</span><br><span class="line">a/1.txt</span><br><span class="line">a/2.txt</span><br><span class="line">d/</span><br><span class="line">d/1.txt</span><br><span class="line">d/2.txt</span><br><span class="line">d/3.txt</span><br><span class="line">sent 300 bytes  received 114 bytes  828.00 bytes/sec</span><br><span class="line">total size is 0  speedup is 0.00</span><br></pre></td></tr></table></figure>

<h3 id="3-5-3-利用–exclude-from方式进行排除"><a href="#3-5-3-利用–exclude-from方式进行排除" class="headerlink" title="3.5.3 利用–exclude-from方式进行排除"></a><strong>3.5.3</strong> 利用–exclude-from方式进行排除</h3><h4 id="第一个里程碑-创建模拟测试环境-1"><a href="#第一个里程碑-创建模拟测试环境-1" class="headerlink" title="第一个里程碑: 创建模拟测试环境"></a>第一个里程碑: 创建模拟测试环境</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 data]# mkdir &#123;a..d&#125;</span><br><span class="line">[root@nfs01 data]# touch &#123;a..d&#125;/&#123;1..3&#125;.txt</span><br></pre></td></tr></table></figure>

<h4 id="第二个里程碑：利用–exlude-from参数，测试排除功能"><a href="#第二个里程碑：利用–exlude-from参数，测试排除功能" class="headerlink" title="第二个里程碑：利用–exlude-from参数，测试排除功能"></a>第二个里程碑：利用–exlude-from参数，测试排除功能</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 data]# vim /tmp/paichu.txt</span><br><span class="line">a/3.txt</span><br><span class="line">b</span><br><span class="line">c</span><br></pre></td></tr></table></figure>

<h4 id="第三个里程碑：进行排除"><a href="#第三个里程碑：进行排除" class="headerlink" title="第三个里程碑：进行排除"></a>第三个里程碑：进行排除</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 data]# rsync -avz /data/ --exclude-from=/tmp/paichu.txt rsync_backup@172.16.1.41::nfsdata</span><br><span class="line">sending incremental file list</span><br><span class="line">./</span><br><span class="line">a/</span><br><span class="line">a/1.txt</span><br><span class="line">a/2.txt</span><br><span class="line">d/</span><br><span class="line">d/1.txt</span><br><span class="line">d/2.txt</span><br><span class="line">d/3.txt</span><br><span class="line">sent 300 bytes  received 114 bytes  828.00 bytes/sec</span><br><span class="line">total size is 0  speedup is 0.00</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：</p>
<p><em>01. 排除文件中，需要利用相对路径指定排除信息（不能利用绝对路径）</em></p>
<p><em>02.</em> <em>相对路径指的是相对同步的目录信息而言，是对**rsync -avz &#x2F;data&#x2F;</em> <em>后面的<strong>data</strong>目录进行相对</em></p>
</blockquote>
<h3 id="3-5-4-在配置文件中修改要排除的文件"><a href="#3-5-4-在配置文件中修改要排除的文件" class="headerlink" title="3.5.4 在配置文件中修改要排除的文件"></a><strong>3.5.4</strong> <strong>在配置文件中修改要排除的文件</strong></h3><h4 id="第一个里程碑：-编写修改服务端配置文件"><a href="#第一个里程碑：-编写修改服务端配置文件" class="headerlink" title="第一个里程碑： 编写修改服务端配置文件"></a>第一个里程碑： 编写修改服务端配置文件</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vim /etc/rsyncd.conf</span><br><span class="line">[nfsdata]</span><br><span class="line">comment = &quot;nfsdata dir by clsn&quot;</span><br><span class="line">path = /backup/nfsdata</span><br><span class="line">exclude=a/3.txt b c</span><br></pre></td></tr></table></figure>

<h4 id="第二个里程碑：重启rsync服务"><a href="#第二个里程碑：重启rsync服务" class="headerlink" title="第二个里程碑：重启rsync服务"></a>第二个里程碑：重启rsync服务</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">killall rsync &amp;&amp; sleep 1 &amp;&amp; rsync --daemon</span><br></pre></td></tr></table></figure>

<h4 id="第三里程碑：-进行测试"><a href="#第三里程碑：-进行测试" class="headerlink" title="第三里程碑： 进行测试"></a>第三里程碑： 进行测试</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 data]# rsync -avz /data/  rsync_backup@172.16.1.41::nfsdata</span><br><span class="line">sending incremental file list</span><br><span class="line">./</span><br><span class="line">a/</span><br><span class="line">a/1.txt</span><br><span class="line">a/2.txt</span><br><span class="line">skipping daemon-excluded file &quot;a/3.txt&quot;</span><br><span class="line">skipping daemon-excluded directory &quot;b&quot;</span><br><span class="line">*** Skipping any contents from this failed directory ***</span><br><span class="line">skipping daemon-excluded directory &quot;c&quot;</span><br><span class="line">*** Skipping any contents from this failed directory ***</span><br><span class="line">d/</span><br><span class="line">d/1.txt</span><br><span class="line">d/2.txt</span><br><span class="line">d/3.txt</span><br><span class="line">sent 407 bytes  received 116 bytes  1046.00 bytes/sec</span><br><span class="line">total size is 0  speedup is 0.00</span><br><span class="line">rsync error: some files/attrs were not transferred (see previous errors) (code 23) at main.c(1039) [sender=3.0.6]</span><br></pre></td></tr></table></figure>

<h2 id="3-6-守护进程来创建备份目录"><a href="#3-6-守护进程来创建备份目录" class="headerlink" title="3.6 守护进程来创建备份目录"></a><strong>3.6</strong> <strong>守护进程来创建备份目录</strong></h2><p>通过客户端命令创建服务端备份目录中子目录</p>
<ol>
<li><p>推送&#x2F;etc&#x2F;services文件到 服务器&#x2F;backup&#x2F;sda&#x2F;目录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup/dba/</span><br><span class="line">sending incremental file list</span><br><span class="line">created directory dba</span><br><span class="line">services</span><br><span class="line">      641020 100%   19.34MB/s    0:00:00 (xfer#1, to-check=0/1)</span><br></pre></td></tr></table></figure>
</li>
<li><p>推送&#x2F;etc&#x2F;services文件到 服务器&#x2F;backup&#x2F;sa&#x2F;目录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sent 127417 bytes  received 27 bytes  254888.00 bytes/sec</span><br><span class="line">total size is 641020  speedup is 5.03</span><br><span class="line">[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup/sa/</span><br><span class="line">sending incremental file list</span><br><span class="line">created directory sa</span><br><span class="line">services</span><br><span class="line">      641020 100%   19.34MB/s    0:00:00 (xfer#1, to-check=0/1)</span><br></pre></td></tr></table></figure>
</li>
<li><p>推送&#x2F;etc&#x2F;services文件到 服务器&#x2F;backup&#x2F;dev&#x2F;目录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sent 127417 bytes  received 27 bytes  254888.00 bytes/sec</span><br><span class="line">total size is 641020  speedup is 5.03</span><br><span class="line">[root@nfs01 ~]# rsync -avzP /etc/services rsync_backup@172.16.1.41::backup/dev/</span><br><span class="line">sending incremental file list</span><br><span class="line">created directory dev</span><br><span class="line">services</span><br><span class="line">      641020 100%   18.71MB/s    0:00:00 (xfer#1, to-check=0/1)</span><br><span class="line"> </span><br><span class="line">sent 127417 bytes  received 27 bytes  254888.00 bytes/sec</span><br><span class="line">total size is 641020  speedup is 5.03</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>检查结果：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup backup]# tree</span><br><span class="line">.</span><br><span class="line">├── dba</span><br><span class="line">│   └── services</span><br><span class="line">├── dev</span><br><span class="line">│   └── services</span><br><span class="line">└── sa</span><br><span class="line">    └── services</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：</p>
<p><em>a 目标目录名称后要加上 “&#x2F;“, 表示创建目录，否则变为修改传输文件名称了</em></p>
<p><em>b</em> <em>利用客户端创建服务备份子目录时，只能创建一级子目录<strong>，不能创建多级子目录</strong>。</em></p>
</blockquote>
</li>
</ol>
<h2 id="3-7-守护进程的访问控制配置"><a href="#3-7-守护进程的访问控制配置" class="headerlink" title="3.7 守护进程的访问控制配置"></a><strong>3.7</strong> <strong>守护进程的访问控制配置</strong></h2><h3 id="第一个里程碑：在服务端配置文件，编写白名单策略或黑名单策略（只能取其一）"><a href="#第一个里程碑：在服务端配置文件，编写白名单策略或黑名单策略（只能取其一）" class="headerlink" title="第一个里程碑：在服务端配置文件，编写白名单策略或黑名单策略（只能取其一）"></a>第一个里程碑：在服务端配置文件，编写白名单策略或黑名单策略（只能取其一）</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vim /etc/rsyncd.conf</span><br><span class="line">    hosts allow = 172.16.1.0/24</span><br><span class="line">    #hosts deny = 0.0.0.0/32</span><br></pre></td></tr></table></figure>

<p>关于访问控制的说明：</p>
<ol>
<li><p>白名单和黑名单同时存在时，默认控制策略为不匹配的传输数据信息全部放行</p>
</li>
<li><p>白名单单一存在时，默认控制策略为不匹配的传输数据信息全部禁止</p>
</li>
<li><p>黑名单单一存在时，默认控制策略为不匹配的传输数据信息全部放行</p>
</li>
<li><p>白名单优先于黑名单</p>
</li>
</ol>
<blockquote>
<p>全局变量修改控制策略信息，rsync服务必须重启</p>
</blockquote>
<h3 id="第二个里程碑：客户端进行测试"><a href="#第二个里程碑：客户端进行测试" class="headerlink" title="第二个里程碑：客户端进行测试"></a>第二个里程碑：客户端进行测试</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 backup]# rsync -avz /etc/services rsync_backup@10.0.0.41::data</span><br><span class="line">@ERROR: Unknown module &#x27;data&#x27;</span><br><span class="line">rsync error: error starting client-server protocol (code 5) at main.c(1503) [sender=3.0.6]</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">[root@nfs01 backup]# rsync -avz /etc/services sync_backup@172.16.1.41::data</span><br><span class="line">sending incremental file list</span><br><span class="line">sent 29 bytes  received 8 bytes  74.00 bytes/sec</span><br><span class="line">total size is 641020  speedup is 17324.86</span><br></pre></td></tr></table></figure>

<h2 id="3-8-守护进程无差异同步配置"><a href="#3-8-守护进程无差异同步配置" class="headerlink" title="3.8 守护进程无差异同步配置"></a><strong>3.8</strong> <strong>守护进程无差异同步配置</strong></h2><h3 id="3-8-1-什么是无差异："><a href="#3-8-1-什么是无差异：" class="headerlink" title="3.8.1 什么是无差异："></a><strong>3.8.1</strong> <strong>什么是无差异：</strong></h3><ul>
<li><p>推模式：我有什么，你就有什么；我没有，你也不能有</p>
</li>
<li><p>拉模式：你有什么，我就有什么；你没有，我也不能有</p>
</li>
</ul>
<blockquote>
<p>总结：<strong>服务端客户端数据完全一致（一模一样）</strong></p>
</blockquote>
<h3 id="3-8-2-实现无差异同步方法"><a href="#3-8-2-实现无差异同步方法" class="headerlink" title="3.8.2 实现无差异同步方法"></a><strong>3.8.2</strong> <strong>实现无差异同步方法</strong></h3><h4 id="第一个里程碑：-创建实验环境"><a href="#第一个里程碑：-创建实验环境" class="headerlink" title="第一个里程碑： 创建实验环境"></a>第一个里程碑： 创建实验环境</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# ll /data/</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct 12 10:29 a</span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct 12 10:40 b</span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct 12 10:29 c</span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct 12 10:29 d</span><br></pre></td></tr></table></figure>

<h4 id="第二个里程：进行第一次数据同步"><a href="#第二个里程：进行第一次数据同步" class="headerlink" title="第二个里程：进行第一次数据同步"></a>第二个里程：进行第一次数据同步</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 ~]# rsync -avz --delete  /data/ rsync_backup@172.16.1.41::backup/</span><br><span class="line">sending incremental file list</span><br><span class="line">./</span><br><span class="line">a/</span><br><span class="line">a/1.txt</span><br><span class="line">a/2.txt</span><br><span class="line">a/3.txt</span><br><span class="line">b/</span><br><span class="line">b/1.txt</span><br><span class="line">b/2.txt</span><br><span class="line">b/3.txt</span><br><span class="line">c/</span><br><span class="line">c/1.txt</span><br><span class="line">c/2.txt</span><br><span class="line">c/3.txt</span><br><span class="line">d/</span><br><span class="line">d/1.txt</span><br><span class="line">d/2.txt</span><br><span class="line">d/3.txt</span><br><span class="line">sent 669 bytes  received 255 bytes  1848.00 bytes/sec</span><br><span class="line">total size is 0  speedup is 0.00</span><br></pre></td></tr></table></figure>

<h4 id="第三个里程：删除指定目录，并添加指定文件，测试无差异功能"><a href="#第三个里程：删除指定目录，并添加指定文件，测试无差异功能" class="headerlink" title="第三个里程：删除指定目录，并添加指定文件，测试无差异功能"></a>第三个里程：删除指定目录，并添加指定文件，测试无差异功能</h4><p>删除客户端中的 a&#x2F; 目录，再进行无差异传输</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 data]# rm a/ -rf</span><br><span class="line">[root@nfs01 data]# rsync -avz --delete  /data/ rsync_backup@172.16.1.41::backup/</span><br><span class="line">sending incremental file list</span><br><span class="line">./</span><br><span class="line">deleting a/3.txt</span><br><span class="line">deleting a/2.txt</span><br><span class="line">deleting a/1.txt</span><br><span class="line">deleting a/</span><br><span class="line">sent 181 bytes  received 14 bytes  390.00 bytes/sec</span><br><span class="line">total size is 0  speedup is 0.00</span><br></pre></td></tr></table></figure>

<h3 id="【注意】无差异同步方法的应用"><a href="#【注意】无差异同步方法的应用" class="headerlink" title="【注意】无差异同步方法的应用"></a>【注意】无差异同步方法的应用</h3><ol>
<li><p>实现储存数据与备份数据完全一致（<strong>慎用</strong>）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rsync -avz --delete  /data/ rsync_backup@172.16.1.41::backup /</span><br></pre></td></tr></table></figure>
</li>
<li><p>快速删除大文件数据</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir /null      --创建出一个空目录。</span><br><span class="line">rsync -avz --delete /null/ /bigdata/</span><br><span class="line"># 删除效率高于 rm -rf /bigdata</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="3-9-守护进程的列表功能配置"><a href="#3-9-守护进程的列表功能配置" class="headerlink" title="3.9 守护进程的列表功能配置"></a><strong>3.9</strong> <strong>守护进程的列表功能配置</strong></h2><h3 id="第一个里程碑：-在服务端配置文件中开启list列表功能"><a href="#第一个里程碑：-在服务端配置文件中开启list列表功能" class="headerlink" title="第一个里程碑： 在服务端配置文件中开启list列表功能"></a>第一个里程碑： 在服务端配置文件中开启list列表功能</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# vim /etc/rsyncd.conf</span><br><span class="line">list = true</span><br></pre></td></tr></table></figure>

<h3 id="第二个里程碑：重启rsync服务-1"><a href="#第二个里程碑：重启rsync服务-1" class="headerlink" title="第二个里程碑：重启rsync服务"></a>第二个里程碑：重启rsync服务</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# killall rsync &amp;&amp; sleep 1 &amp;&amp; rsync --daemon</span><br></pre></td></tr></table></figure>

<h3 id="第三个里程碑：-客户端查看服务端模块信息"><a href="#第三个里程碑：-客户端查看服务端模块信息" class="headerlink" title="第三个里程碑： 客户端查看服务端模块信息"></a>第三个里程碑： 客户端查看服务端模块信息</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 data]# rsync rsync_backup@172.16.1.41::</span><br><span class="line">backup         &quot;backup dir by clsn&quot;</span><br><span class="line">nfsdata        &quot;nfsdata dir by clsn&quot;</span><br><span class="line">nfsbackup      &quot;nfsbackup dir by clsn&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：</p>
<p>为了提升备份服务器安全性，建议关闭list列表功能</p>
</blockquote>
<h2 id="4-0-备份文件完整性检查"><a href="#4-0-备份文件完整性检查" class="headerlink" title="4.0 备份文件完整性检查"></a><strong>4.0</strong> <strong>备份文件完整性检查</strong></h2><h3 id="4-0-1客户端生成"><a href="#4-0-1客户端生成" class="headerlink" title="4.0.1客户端生成"></a>4.0.1客户端生成</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">md5sum ljq.txt                   //生成这个文件的md5效验值</span><br></pre></td></tr></table></figure>

<h3 id="4-0-2服务端对比效验"><a href="#4-0-2服务端对比效验" class="headerlink" title="4.0.2服务端对比效验"></a>4.0.2服务端对比效验</h3><p>md5sum -c 指纹文件命令执行原理</p>
<ol>
<li>打开一个指纹文件，将信息记录到缓存中</li>
<li>根据指纹文件的路径，生成md5的数值</li>
<li>将新生成md5数值和原有指纹文件数值进行比较</li>
<li>如过相同显示结果为ok，如果不同显示failed</li>
</ol>
<h2 id="4-1-守护进程服务企业应用"><a href="#4-1-守护进程服务企业应用" class="headerlink" title="4.1 守护进程服务企业应用"></a><strong>4.1</strong> <strong>守护进程服务企业应用</strong></h2><p>守护进程多模块功能配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[backup]                                                                   </span><br><span class="line">comment = &quot;backup dir by clsn&quot;                                   </span><br><span class="line">path = /backup </span><br><span class="line">[dba]                                                                   </span><br><span class="line">comment = &quot;backup dir by clsn&quot;                                   </span><br><span class="line">path = /dba</span><br><span class="line">[dev]                                                                   </span><br><span class="line">comment = &quot;backup dir by clsn&quot;                                   </span><br><span class="line">path = /dev</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ps：可以划分多个部门，不同部门的主机分布存放不同的文件夹下</p>
</blockquote>
<p>守护进程的排除功能实践</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[ljq@LN /]$mkdir -p rsync_exclude</span><br><span class="line">[ljq@LN /]$mkdir -p rsync_exclude/&#123;a..c&#125;</span><br><span class="line">[ljq@LN /]$touch rsync_exclude/&#123;a..c&#125;/&#123;1..3&#125;.txt</span><br><span class="line">[ljq@LN /]$tree rsync_exclude/</span><br><span class="line">rsync_exclude/</span><br><span class="line">├── a</span><br><span class="line">│   ├── 1.txt</span><br><span class="line">│   ├── 2.txt</span><br><span class="line">│   └── 3.txt</span><br><span class="line">├── b</span><br><span class="line">│   ├── 1.txt</span><br><span class="line">│   ├── 2.txt</span><br><span class="line">│   └── 3.txt</span><br><span class="line">└── c</span><br><span class="line">		├── 1.txt</span><br><span class="line">		├── 2.txt</span><br><span class="line">		└── 3.txt</span><br><span class="line">				</span><br><span class="line">3 directories, 9 files</span><br></pre></td></tr></table></figure>

<h3 id="4-1-1-需求1"><a href="#4-1-1-需求1" class="headerlink" title="4.1.1 需求1"></a>4.1.1 需求1</h3><p>将&#x2F;rsync_exlude目录下 a目录数据全部备份 b目录不要备份1.txt文件 c整个目录不要做备份</p>
<ol>
<li><p>绝对路径</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rsync -avz /rsync_excluude --exclude=/rsync_exclude/b/1.txt --exclude=/rsync_exclude/c/ rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password</span><br></pre></td></tr></table></figure>
</li>
<li><p>相对路径</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rsync -avz /rsync_excluude --exclude=b/1.txt --exclude=c/ rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="4-2企业中应用实例，及发送邮箱配置"><a href="#4-2企业中应用实例，及发送邮箱配置" class="headerlink" title="4.2企业中应用实例，及发送邮箱配置"></a><strong>4.2</strong>企业中应用实例，及发送邮箱配置</h2><h3 id="4-2-1-实现发送邮件"><a href="#4-2-1-实现发送邮件" class="headerlink" title="4.2.1 实现发送邮件"></a>4.2.1 实现发送邮件</h3><ol>
<li><p>配置163企业邮箱</p>
</li>
<li><p>编写Linux服务邮件相关配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vim /etc/mail.rc</span><br><span class="line">set from=13164646190@163.com smtp=smtp.163.com</span><br><span class="line">set smtp-auth-user=13164646190@163.com smtp-auth-password=授权密码 smtp-auth=login</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启自带的邮件服务</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">systemctl restart postfix.service</span><br></pre></td></tr></table></figure>
</li>
<li><p>发送邮件测试</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &quot;邮件发送测试&quot; | mail -s “邮件测试”目标邮箱</span><br><span class="line">mail -s “邮件测试”目标邮箱 &lt; /etc/hosts   //以hosts文件为文件内容发送</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="4-2-2编写全网备份脚本"><a href="#4-2-2编写全网备份脚本" class="headerlink" title="4.2.2编写全网备份脚本"></a>4.2.2编写全网备份脚本</h3><p>客户端脚本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir /server/scripts -p     //建立一个专门放脚本的文件</span><br><span class="line">vim backup.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">						</span><br><span class="line">Backup_dir=&quot;/backup&quot;      //定义变量，方便更换</span><br><span class="line">IP_info=$(hostname -i)</span><br><span class="line">						</span><br><span class="line">#create backup dir</span><br><span class="line">mkdir -p $Backup_dir/$IP_info/</span><br><span class="line">						</span><br><span class="line">#tar backup data</span><br><span class="line">cd /</span><br><span class="line">tar zcvf $Backup_dir/$IP_info/date_$(date +%F_week%w -d -1day).tar.gz /etc/hosts</span><br><span class="line">						</span><br><span class="line">#del 7 day ago date</span><br><span class="line">find $Backup_dir -type f -mtime +7 | xargs rm 2&gt;/dev/null</span><br><span class="line">						</span><br><span class="line">#create finger file</span><br><span class="line">find $Backup_dir/ -type f -mtime -1 ! -name &quot;finger*&quot; | xargs md5sum &gt; $Backup_dir/$IP_info/finger.txt</span><br><span class="line">						</span><br><span class="line">#backup push data info</span><br><span class="line">rsync -avz $Backup_dir/ rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password</span><br></pre></td></tr></table></figure>

<p>服务端脚本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir /server/scripts -p  </span><br><span class="line">mkdir -p /backup/10.0.0.31/</span><br><span class="line">vim backup-server.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">						</span><br><span class="line">#del 180 day ago data</span><br><span class="line">ind /backup/ -type f -mtime +180 ! -name &quot;*week1.tar.gz&quot; | xargs rm 2&gt;/dev/null</span><br><span class="line">						</span><br><span class="line">#check backup data</span><br><span class="line">find /backup/ -type f -name &quot;finger.txt&quot; | xargs md5sum -c &gt;/tmp/check.txt</span><br><span class="line">						</span><br><span class="line">#send check mail</span><br><span class="line">mail -s &quot;check backup info for $(date +%F)&quot; 2044307912@qq.com&lt;/tmp/check.txt</span><br></pre></td></tr></table></figure>

<h3 id="4-2-3-实现自动完成全网数据备份（定时任务）"><a href="#4-2-3-实现自动完成全网数据备份（定时任务）" class="headerlink" title="4.2.3 实现自动完成全网数据备份（定时任务）"></a>4.2.3 实现自动完成全网数据备份（定时任务）</h3><p>客户端定时任务</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">crontab -e</span><br><span class="line"># backup data</span><br><span class="line">0 0 * * * /bin/sh  /server/scripts/backup.sh &amp;&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p>服务端定时任务</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">crontab -e</span><br><span class="line"># backup data</span><br><span class="line">0 5 * * * /bin/sh  /server/scripts/backup-server.sh &amp;&gt;/dev/null</span><br></pre></td></tr></table></figure>

<h1 id="第4章-小结"><a href="#第4章-小结" class="headerlink" title="第4章 小结"></a><strong>第</strong>4章 <strong>小结</strong></h1><p>在使用rsync备份目录时</p>
<ol>
<li>备份目录后面有 &#x2F; – &#x2F;ljqfile&#x2F; ： 只会将目录下面的内容进行备份传输</li>
<li>备份目录后面没有 &#x2F; – &#x2F;ljqfile ： 会将目录本身及下面的内容进行备份传输</li>
</ol>
<p>rsync服务部署安装过程</p>
<ol>
<li>下载安装软件 yum</li>
<li>编写配置文件</li>
<li>搭建服务环境 备份的目录&#x2F;目录权限</li>
<li>启动服务程序  开机自动启动</li>
<li>测试服务功能</li>
</ol>
<h1 id="第5章-常见问题"><a href="#第5章-常见问题" class="headerlink" title="第5章 常见问题"></a><strong>第</strong>5章 <strong>常见问题</strong></h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@nfs01 tmp]# rsync -avz /etc/hosts  rsync_backup@172.16.1.41::backup</span><br><span class="line">Password:</span><br><span class="line">sending incremental file list</span><br><span class="line">hosts</span><br><span class="line">rsync: mkstemp &quot;.hosts.U5OCyR&quot; (in backup) failed: Permission denied (13)</span><br><span class="line">sent 200 bytes  received 27 bytes  13.76 bytes/sec</span><br><span class="line">total size is 371  speedup is 1.63</span><br><span class="line">rsync error: some files/attrs were not transferred (see previous errors) (code 23) at main.c(1039) [sender=3.0.6]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：备份目录权限设置不正确</p>
</blockquote>
<p>解决办法：</p>
<p>将服务端的备份存放目录（path值），属主和属组修改为rsync。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@backup ~]# chown -R rsync.rsync /backup/ </span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/%E9%97%AE%E9%A2%981.png" alt="问题1"></p>
<p><img src="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/%E9%97%AE%E9%A2%982.png" alt="问题2"></p>
<p><img src="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/%E9%97%AE%E9%A2%983.png" alt="问题3"></p>
<p><img src="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/%E9%97%AE%E9%A2%984.png" alt="问题4"></p>
<p><img src="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/%E9%97%AE%E9%A2%985.png" alt="问题5"></p>
<p><img src="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/%E9%97%AE%E9%A2%986.png" alt="问题6"></p>
<p><img src="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/%E9%97%AE%E9%A2%987.png" alt="问题7"></p>
<p><img src="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/%E9%97%AE%E9%A2%988.png" alt="问题8"></p>
<p><img src="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/%E9%97%AE%E9%A2%989.png" alt="问题9"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://blog.cndis.cn">JANKINLUI</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://blog.cndis.cn/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/">http://blog.cndis.cn/2022/08/04/云计算运维综合架构/rsync备份服务项目/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://blog.cndis.cn" target="_blank">今日放弃堕落</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/">云计算运维综合架构</a><a class="post-meta__tags" href="/tags/rsync/">rsync</a><a class="post-meta__tags" href="/tags/%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/">备份服务项目</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/08/07/Linux%E8%BF%90%E7%BB%B4/%E5%AE%89%E8%A3%85neofetch/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">安装neofetch</div></div></a></div><div class="next-post pull-right"><a href="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84%E8%AF%A6%E8%A7%A3-%E6%A8%A1%E6%9D%BF%E6%9C%BA%E9%85%8D%E7%BD%AE/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">综合架构详解&amp;模板机配置</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/07/31/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/Linux%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" title="Linux定时任务"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-31</div><div class="title">Linux定时任务</div></div></a></div><div><a href="/2022/07/30/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/Linux%E7%94%A8%E6%88%B7%E5%92%8C%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E8%AF%A6%E8%A7%A3/" title="Linux用户和用户组管理相关文件内容详解"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-30</div><div class="title">Linux用户和用户组管理相关文件内容详解</div></div></a></div><div><a href="/2022/07/28/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/Linux%E7%B3%BB%E7%BB%9F%E7%9B%AE%E5%BD%95%E8%AF%A6%E8%A7%A3/" title="Linux系统目录详解"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-28</div><div class="title">Linux系统目录详解</div></div></a></div><div><a href="/2022/07/31/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/Linux%E7%BD%91%E7%BB%9C/" title="Linux网络"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-31</div><div class="title">Linux网络</div></div></a></div><div><a href="/2022/08/07/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/sersync%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1/" title="sersync实时同步服务"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-07</div><div class="title">sersync实时同步服务</div></div></a></div><div><a href="/2022/07/31/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/" title="基础网络知识"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-31</div><div class="title">基础网络知识</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">JANKINLUI</div><div class="author-info__description">Hello Word</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">85</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Welcome to my homepage!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0-rsync-%E8%BD%AF%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">第1章 rsync 软件介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AFrsync"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 什么是rsync</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-1-%E5%85%A8%E9%87%8F%E5%8F%8A%E5%A2%9E%E9%87%8F"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1.1 全量及增量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%AE%9E%E7%8E%B0%E5%A2%9E%E9%87%8F%E5%A4%8D%E5%88%B6%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 实现增量复制的原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E8%BD%AF%E4%BB%B6%E7%89%88%E6%9C%AC"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 软件版本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-rsync-%E8%BD%AF%E4%BB%B6%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 rsync 软件功能介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-rsync-x3D-x3D-cp"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.3.1 rsync &#x3D;&#x3D; cp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-rsync-x3D-x3D-scp"><span class="toc-number">1.3.2.</span> <span class="toc-text">1.3.2 rsync &#x3D;&#x3D; scp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3-rsync-x3D-x3D-rm"><span class="toc-number">1.3.3.</span> <span class="toc-text">1.3.3 rsync &#x3D;&#x3D; rm</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-3-1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">1.3.3.1 环境准备</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-4-rsync-x3D-x3D-ls-l"><span class="toc-number">1.3.4.</span> <span class="toc-text">1.3.4 rsync &#x3D;&#x3D; ls -l</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-Rsync%E7%9A%84%E7%89%B9%E6%80%A7%E6%80%BB%E7%BB%93%EF%BC%887%E4%B8%AA%E7%89%B9%E6%80%A7%E4%BF%A1%E6%81%AF%E8%AF%B4%E6%98%8E%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 Rsync的特性总结（7个特性信息说明）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-Rsync%E7%9A%84%E4%BC%81%E4%B8%9A%E5%B7%A5%E4%BD%9C%E5%9C%BA%E6%99%AF%E8%AF%B4%E6%98%8E"><span class="toc-number">1.5.</span> <span class="toc-text">1.5 Rsync的企业工作场景说明</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-rsync%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">第2章 rsync使用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-rsync%E8%BD%AF%E4%BB%B6%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 rsync软件工作方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E6%9C%AC%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E6%96%B9%E5%BC%8F%EF%BC%88%E7%B1%BB%E4%BC%BC%E4%BA%8Ecp%EF%BC%89"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 本地数据同步方式（类似于cp）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-1-%E5%AE%9E%E4%BE%8B%E6%BC%94%E7%A4%BA%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">2.1.1.1 实例演示命令：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-%E8%BF%9C%E7%A8%8B%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E6%96%B9%E5%BC%8F%EF%BC%88%E7%B1%BB%E4%BC%BCscp%EF%BC%89%E2%80%94%E5%8F%88%E7%A7%B0%E4%B8%BA%E9%9A%A7%E9%81%93%E4%BC%A0%E8%BE%93"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 远程数据同步方式（类似scp）—又称为隧道传输</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-%E3%80%90%E5%AE%9E%E8%B7%B5%E6%93%8D%E4%BD%9C%E3%80%91pull%E6%8B%89"><span class="toc-number">2.1.3.</span> <span class="toc-text">2.1.3 【实践操作】pull拉</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4-%E3%80%90%E5%AE%9E%E8%B7%B5%E6%93%8D%E4%BD%9C%E3%80%91push%E6%8E%A8%EF%BC%88%E7%9B%AE%E5%BD%95%EF%BC%89"><span class="toc-number">2.1.4.</span> <span class="toc-text">2.1.4 【实践操作】push推（目录）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E6%96%B9%E5%BC%8F%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 守护进程方式同步数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E9%85%8D%E7%BD%AErsync%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E6%96%B9%E5%BC%8F%EF%BC%88%E9%9C%80%E8%A6%81%E6%9C%89%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%89"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 配置rsync守护进程方式（需要有服务端与客户端）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E9%85%8D%E7%BD%AErsync%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%88%E5%B0%86%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE%E5%88%B0-backup-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%EF%BC%89"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 配置rsync服务端（将服务端配置到 backup 服务器上）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E8%BD%AF%E4%BB%B6%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">第一个里程碑： 软件是否存在</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E8%BF%9B%E8%A1%8C%E8%BD%AF%E4%BB%B6%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">第二个里程碑： 进行软件服务配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E4%B8%AA%E9%87%8C%E7%A8%8B%EF%BC%9A%E5%88%9B%E5%BB%BArsync%E7%94%A8%E6%88%B7"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">第三个里程：创建rsync用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%82%A8%E5%AD%98%E7%9B%AE%E5%BD%95-%E7%9B%AE%E5%BD%95%E4%BF%AE%E6%94%B9%E5%B1%9E%E4%B8%BB"><span class="toc-number">2.2.2.4.</span> <span class="toc-text">第四个里程碑： 创建数据备份储存目录,目录修改属主</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E5%88%9B%E5%BB%BA%E8%AE%A4%E8%AF%81%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.2.5.</span> <span class="toc-text">第五个里程碑： 创建认证用户密码文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E5%90%AF%E5%8A%A8rsync%E6%9C%8D"><span class="toc-number">2.2.2.6.</span> <span class="toc-text">第六个里程碑： 启动rsync服</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%B3%E6%AD%A4%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE%E5%AE%8C%E6%88%90"><span class="toc-number">2.2.2.7.</span> <span class="toc-text">至此服务端配置完成</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E9%85%8D%E7%BD%AErsync%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%88%E5%85%B6%E4%BB%96%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BA%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%89"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.3 配置rsync客户端（其他服务器为客户端）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E8%BD%AF%E4%BB%B6%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8-1"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">第一个里程碑： 软件是否存在</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E5%88%9B%E5%BB%BA%E8%AE%A4%E8%AF%81%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.3.2.</span> <span class="toc-text">第二个里程碑： 创建认证文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93"><span class="toc-number">2.2.3.3.</span> <span class="toc-text">第三个里程碑： 实现数据传输</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%A4%E4%BA%92%E5%BC%8F"><span class="toc-number">2.2.3.3.1.</span> <span class="toc-text">交互式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%8D%E4%BA%A4%E4%BA%92%E5%BC%8F"><span class="toc-number">2.2.3.3.2.</span> <span class="toc-text">免交互式</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-rsync%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E4%BC%A0%E8%BE%93%E6%95%B0%E6%8D%AE%E5%8E%9F%E7%90%86"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 rsync守护进程传输数据原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-rsync-%E5%91%BD%E4%BB%A4%E5%90%8C%E6%AD%A5%E5%8F%82%E6%95%B0%E9%80%89%E9%A1%B9-amp-%E7%89%B9%E6%AE%8A%E5%8F%82%E6%95%B0"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 rsync 命令同步参数选项&amp;特殊参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-%E7%89%B9%E6%AE%8A%E5%8F%82%E6%95%B0%E5%AE%9E%E8%B7%B5"><span class="toc-number">2.4.1.</span> <span class="toc-text">2.4.1 特殊参数实践</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9Aip"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">指定ip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%B5%8B%E8%AF%95"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">参数测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84"><span class="toc-number">2.4.1.3.</span> <span class="toc-text">指定配置文件路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%8C%87%E5%AE%9A%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3"><span class="toc-number">2.4.1.4.</span> <span class="toc-text">服务端指定服务端口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-%E5%91%BD%E4%BB%A4%E5%B0%8F%E7%BB%93"><span class="toc-number">2.4.2.</span> <span class="toc-text">2.4.2 命令小结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-rsycn%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3rsyncd-conf"><span class="toc-number">3.</span> <span class="toc-text">第3章 rsycn配置文件详解rsyncd.conf</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E9%83%A8%E5%88%86%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 部分知识补充</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 配置文件内容参考资料</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E6%80%BB%E7%BB%93"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2 配置文件内容总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%88%A9%E7%94%A8-x2F-etc-x2F-init-d-x2F-%E5%90%AF%E5%8A%A8rsync%E6%9C%8D%E5%8A%A1%E6%96%B9%E5%BC%8F"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 利用&#x2F;etc&#x2F;init.d&#x2F;启动rsync服务方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E5%8F%AF%E4%BB%A5%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%EF%BC%9A"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 可以实现方式：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E5%88%A9%E7%94%A8xinetd%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86rsync"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 利用xinetd服务管理rsync</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E5%AE%89%E8%A3%85xinetd%E8%BD%AF%E4%BB%B6"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">第一个里程碑： 安装xinetd软件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">第二个里程碑：编辑配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A%E9%87%8D%E5%90%AFxinetd%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">第三个里程碑：重启xinetd服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E6%B5%8B%E8%AF%95"><span class="toc-number">3.2.2.4.</span> <span class="toc-text">传输测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F%E4%BF%A1%E6%81%AF%E5%AE%9E%E7%8E%B0%E5%85%8D%E7%A7%98%E9%92%A5%E4%BA%A4%E4%BA%92"><span class="toc-number">3.3.</span> <span class="toc-text">定义变量信息实现免秘钥交互</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E9%80%9A%E8%BF%87man%E6%89%8B%E5%86%8C%E8%8E%B7%E5%BE%97%E6%96%B9%E6%B3%95"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 通过man手册获得方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E4%BD%BF%E7%94%A8RSYNC-PASSWORD-%E5%8F%98%E9%87%8F%E5%AE%9E%E7%8E%B0%E5%85%8D%E4%BA%A4%E4%BA%92"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2 使用RSYNC_PASSWORD 变量实现免交互</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-%E4%BD%BF%E7%94%A8-rsync-password%E6%96%87%E4%BB%B6%E5%AE%9E%E7%8E%B0%E5%85%8D%E4%BA%A4%E4%BA%92"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.3.3 使用 rsync.password文件实现免交互</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E5%A4%9A%E6%A8%A1%E5%9D%97%E5%8A%9F%E8%83%BD%E9%85%8D%E7%BD%AE"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 守护进程多模块功能配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E5%88%9B%E5%BB%BA%E5%A4%9A%E6%A8%A1%E5%9D%97"><span class="toc-number">3.4.1.</span> <span class="toc-text">第一个里程碑： 编写配置信息创建多模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E5%88%9B%E5%BB%BA%E5%A4%9A%E6%A8%A1%E5%9D%97%E6%8C%87%E5%AE%9A%E7%9A%84%E7%9B%AE%E5%BD%95"><span class="toc-number">3.4.2.</span> <span class="toc-text">第二个里程碑： 创建多模块指定的目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E5%88%A9%E7%94%A8rsync%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95"><span class="toc-number">3.4.3.</span> <span class="toc-text">第三里程碑： 利用rsync客户端进行测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%8E%92%E9%99%A4%E5%8A%9F%E8%83%BD%E5%AE%9E%E8%B7%B5"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 守护进程的排除功能实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-1-%E6%8E%92%E9%99%A4%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">3.5.1.</span> <span class="toc-text">3.5.1 排除的方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-2-%E6%8E%92%E9%99%A4%E6%B5%8B%E8%AF%95"><span class="toc-number">3.5.2.</span> <span class="toc-text">3.5.2 排除测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91-%E5%88%9B%E5%BB%BA%E6%A8%A1%E6%8B%9F%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83"><span class="toc-number">3.5.2.1.</span> <span class="toc-text">第一个里程碑: 创建模拟测试环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91-%E5%88%A9%E7%94%A8-%E2%80%93exclude%E5%8F%82%E6%95%B0%E6%B5%8B%E8%AF%95%E6%8E%92%E9%99%A4%E5%8A%9F%E8%83%BD"><span class="toc-number">3.5.2.2.</span> <span class="toc-text">第二个里程碑 利用 –exclude参数测试排除功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-3-%E5%88%A9%E7%94%A8%E2%80%93exclude-from%E6%96%B9%E5%BC%8F%E8%BF%9B%E8%A1%8C%E6%8E%92%E9%99%A4"><span class="toc-number">3.5.3.</span> <span class="toc-text">3.5.3 利用–exclude-from方式进行排除</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91-%E5%88%9B%E5%BB%BA%E6%A8%A1%E6%8B%9F%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83-1"><span class="toc-number">3.5.3.1.</span> <span class="toc-text">第一个里程碑: 创建模拟测试环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A%E5%88%A9%E7%94%A8%E2%80%93exlude-from%E5%8F%82%E6%95%B0%EF%BC%8C%E6%B5%8B%E8%AF%95%E6%8E%92%E9%99%A4%E5%8A%9F%E8%83%BD"><span class="toc-number">3.5.3.2.</span> <span class="toc-text">第二个里程碑：利用–exlude-from参数，测试排除功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A%E8%BF%9B%E8%A1%8C%E6%8E%92%E9%99%A4"><span class="toc-number">3.5.3.3.</span> <span class="toc-text">第三个里程碑：进行排除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-4-%E5%9C%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E4%BF%AE%E6%94%B9%E8%A6%81%E6%8E%92%E9%99%A4%E7%9A%84%E6%96%87%E4%BB%B6"><span class="toc-number">3.5.4.</span> <span class="toc-text">3.5.4 在配置文件中修改要排除的文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E7%BC%96%E5%86%99%E4%BF%AE%E6%94%B9%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.5.4.1.</span> <span class="toc-text">第一个里程碑： 编写修改服务端配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A%E9%87%8D%E5%90%AFrsync%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.5.4.2.</span> <span class="toc-text">第二个里程碑：重启rsync服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95"><span class="toc-number">3.5.4.3.</span> <span class="toc-text">第三里程碑： 进行测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E6%9D%A5%E5%88%9B%E5%BB%BA%E5%A4%87%E4%BB%BD%E7%9B%AE%E5%BD%95"><span class="toc-number">3.6.</span> <span class="toc-text">3.6 守护进程来创建备份目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">3.7.</span> <span class="toc-text">3.7 守护进程的访问控制配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A%E5%9C%A8%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E7%BC%96%E5%86%99%E7%99%BD%E5%90%8D%E5%8D%95%E7%AD%96%E7%95%A5%E6%88%96%E9%BB%91%E5%90%8D%E5%8D%95%E7%AD%96%E7%95%A5%EF%BC%88%E5%8F%AA%E8%83%BD%E5%8F%96%E5%85%B6%E4%B8%80%EF%BC%89"><span class="toc-number">3.7.1.</span> <span class="toc-text">第一个里程碑：在服务端配置文件，编写白名单策略或黑名单策略（只能取其一）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95"><span class="toc-number">3.7.2.</span> <span class="toc-text">第二个里程碑：客户端进行测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-8-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E6%97%A0%E5%B7%AE%E5%BC%82%E5%90%8C%E6%AD%A5%E9%85%8D%E7%BD%AE"><span class="toc-number">3.8.</span> <span class="toc-text">3.8 守护进程无差异同步配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-1-%E4%BB%80%E4%B9%88%E6%98%AF%E6%97%A0%E5%B7%AE%E5%BC%82%EF%BC%9A"><span class="toc-number">3.8.1.</span> <span class="toc-text">3.8.1 什么是无差异：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-2-%E5%AE%9E%E7%8E%B0%E6%97%A0%E5%B7%AE%E5%BC%82%E5%90%8C%E6%AD%A5%E6%96%B9%E6%B3%95"><span class="toc-number">3.8.2.</span> <span class="toc-text">3.8.2 实现无差异同步方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E5%88%9B%E5%BB%BA%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">3.8.2.1.</span> <span class="toc-text">第一个里程碑： 创建实验环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%87%8C%E7%A8%8B%EF%BC%9A%E8%BF%9B%E8%A1%8C%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5"><span class="toc-number">3.8.2.2.</span> <span class="toc-text">第二个里程：进行第一次数据同步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E4%B8%AA%E9%87%8C%E7%A8%8B%EF%BC%9A%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9A%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%B9%B6%E6%B7%BB%E5%8A%A0%E6%8C%87%E5%AE%9A%E6%96%87%E4%BB%B6%EF%BC%8C%E6%B5%8B%E8%AF%95%E6%97%A0%E5%B7%AE%E5%BC%82%E5%8A%9F%E8%83%BD"><span class="toc-number">3.8.2.3.</span> <span class="toc-text">第三个里程：删除指定目录，并添加指定文件，测试无差异功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%90%E6%B3%A8%E6%84%8F%E3%80%91%E6%97%A0%E5%B7%AE%E5%BC%82%E5%90%8C%E6%AD%A5%E6%96%B9%E6%B3%95%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">3.8.3.</span> <span class="toc-text">【注意】无差异同步方法的应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-9-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%97%E8%A1%A8%E5%8A%9F%E8%83%BD%E9%85%8D%E7%BD%AE"><span class="toc-number">3.9.</span> <span class="toc-text">3.9 守护进程的列表功能配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E5%9C%A8%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E5%BC%80%E5%90%AFlist%E5%88%97%E8%A1%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">3.9.1.</span> <span class="toc-text">第一个里程碑： 在服务端配置文件中开启list列表功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A%E9%87%8D%E5%90%AFrsync%E6%9C%8D%E5%8A%A1-1"><span class="toc-number">3.9.2.</span> <span class="toc-text">第二个里程碑：重启rsync服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E4%B8%AA%E9%87%8C%E7%A8%8B%E7%A2%91%EF%BC%9A-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E5%9D%97%E4%BF%A1%E6%81%AF"><span class="toc-number">3.9.3.</span> <span class="toc-text">第三个里程碑： 客户端查看服务端模块信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-0-%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A3%80%E6%9F%A5"><span class="toc-number">3.10.</span> <span class="toc-text">4.0 备份文件完整性检查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-0-1%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%94%9F%E6%88%90"><span class="toc-number">3.10.1.</span> <span class="toc-text">4.0.1客户端生成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-0-2%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AF%B9%E6%AF%94%E6%95%88%E9%AA%8C"><span class="toc-number">3.10.2.</span> <span class="toc-text">4.0.2服务端对比效验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E6%9C%8D%E5%8A%A1%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8"><span class="toc-number">3.11.</span> <span class="toc-text">4.1 守护进程服务企业应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E9%9C%80%E6%B1%821"><span class="toc-number">3.11.1.</span> <span class="toc-text">4.1.1 需求1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2%E4%BC%81%E4%B8%9A%E4%B8%AD%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B%EF%BC%8C%E5%8F%8A%E5%8F%91%E9%80%81%E9%82%AE%E7%AE%B1%E9%85%8D%E7%BD%AE"><span class="toc-number">3.12.</span> <span class="toc-text">4.2企业中应用实例，及发送邮箱配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-%E5%AE%9E%E7%8E%B0%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6"><span class="toc-number">3.12.1.</span> <span class="toc-text">4.2.1 实现发送邮件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2%E7%BC%96%E5%86%99%E5%85%A8%E7%BD%91%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC"><span class="toc-number">3.12.2.</span> <span class="toc-text">4.2.2编写全网备份脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%AE%8C%E6%88%90%E5%85%A8%E7%BD%91%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%EF%BC%88%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%EF%BC%89"><span class="toc-number">3.12.3.</span> <span class="toc-text">4.2.3 实现自动完成全网数据备份（定时任务）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-%E5%B0%8F%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">第4章 小结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">第5章 常见问题</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/09/18/Markdown/Markdown%E8%AF%AD%E6%B3%95%E5%8F%8AHexo%E5%91%BD%E4%BB%A4/" title="Markdown语法及Hexo命令"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Markdown语法及Hexo命令"/></a><div class="content"><a class="title" href="/2022/09/18/Markdown/Markdown%E8%AF%AD%E6%B3%95%E5%8F%8AHexo%E5%91%BD%E4%BB%A4/" title="Markdown语法及Hexo命令">Markdown语法及Hexo命令</a><time datetime="2022-09-18T06:04:01.000Z" title="发表于 2022-09-18 14:04:01">2022-09-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/07/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/sersync%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1/" title="sersync实时同步服务"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="sersync实时同步服务"/></a><div class="content"><a class="title" href="/2022/08/07/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/sersync%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1/" title="sersync实时同步服务">sersync实时同步服务</a><time datetime="2022-08-07T01:33:04.000Z" title="发表于 2022-08-07 09:33:04">2022-08-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/07/Linux%E8%BF%90%E7%BB%B4/%E5%AE%89%E8%A3%85neofetch/" title="安装neofetch"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="安装neofetch"/></a><div class="content"><a class="title" href="/2022/08/07/Linux%E8%BF%90%E7%BB%B4/%E5%AE%89%E8%A3%85neofetch/" title="安装neofetch">安装neofetch</a><time datetime="2022-08-07T01:24:06.000Z" title="发表于 2022-08-07 09:24:06">2022-08-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/" title="rsync备份服务项目"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="rsync备份服务项目"/></a><div class="content"><a class="title" href="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/rsync%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/" title="rsync备份服务项目">rsync备份服务项目</a><time datetime="2022-08-04T12:10:45.000Z" title="发表于 2022-08-04 20:10:45">2022-08-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84%E8%AF%A6%E8%A7%A3-%E6%A8%A1%E6%9D%BF%E6%9C%BA%E9%85%8D%E7%BD%AE/" title="综合架构详解&amp;模板机配置"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="综合架构详解&amp;模板机配置"/></a><div class="content"><a class="title" href="/2022/08/04/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%BF%90%E7%BB%B4%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84%E8%AF%A6%E8%A7%A3-%E6%A8%A1%E6%9D%BF%E6%9C%BA%E9%85%8D%E7%BD%AE/" title="综合架构详解&amp;模板机配置">综合架构详解&amp;模板机配置</a><time datetime="2022-08-04T09:22:20.000Z" title="发表于 2022-08-04 17:22:20">2022-08-04</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By JANKINLUI</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="/pluginsSrc/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/pluginsSrc/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'eojgLaBUPGa7ZfoFdUWmWZot-gzGzoHsz',
      appKey: '0HeOXz63nqlHMsYDDddmkX2w',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('/pluginsSrc/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="/pluginsSrc/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="/pluginsSrc/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="/pluginsSrc/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>